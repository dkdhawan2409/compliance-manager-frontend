# Redirect URI Flow Explanation

## üîç How Redirect URI Works

### **Answer: YES, redirect URI comes from the FRONTEND, not the backend**

The redirect URI is generated by the **frontend** and sent to the **backend**. Here's the complete flow:

## üìã Complete OAuth Flow

### 1. **Frontend Generates Redirect URI**
```javascript
// In getXeroAuthUrl()
const redirectUri = getRenderRedirectUri(); // Returns: https://compliance-manager-frontend.onrender.com/redirecturl
```

### 2. **Frontend Sends to Backend**
```javascript
const response = await apiClient.get('/xero/login', {
  params: {
    redirect_uri: redirectUri,  // Frontend sends this to backend
    state: state
  }
});
```

### 3. **Backend Uses Redirect URI**
- Backend receives the redirect URI from frontend
- Backend uses this redirect URI to generate Xero OAuth URL
- Backend returns the Xero OAuth URL to frontend

### 4. **Xero Redirects Back**
- User authorizes on Xero
- Xero redirects to the redirect URI: `https://compliance-manager-frontend.onrender.com/redirecturl?code=...&state=...`

### 5. **Frontend Handles Callback**
```javascript
// In XeroRedirect.tsx
const redirectUri = getRenderRedirectUri(); // Same URI used in step 1
// Send to backend for token exchange
```

## üîß What I Fixed

### **Problem**: Inconsistent redirect URI usage
- `getXeroAuthUrl()` was using `getRenderRedirectUri()`
- `XeroRedirect.tsx` was using `getForcedRedirectUri()`
- This caused mismatch between OAuth start and callback

### **Solution**: Consistent redirect URI usage
- Both functions now use `getRenderRedirectUri()`
- Always returns: `https://compliance-manager-frontend.onrender.com/redirecturl`
- No localhost fallback

## üéØ Key Points

1. **Frontend generates** the redirect URI
2. **Frontend sends** it to backend
3. **Backend uses** it to create Xero OAuth URL
4. **Xero redirects** to the same URI
5. **Frontend receives** the callback
6. **Frontend sends** the same URI back to backend for token exchange

## ‚úÖ Current Implementation

```javascript
// Both functions now use the same redirect URI
const redirectUri = getRenderRedirectUri();
// Always returns: https://compliance-manager-frontend.onrender.com/redirecturl
```

## üö® Important

The redirect URI must be **exactly the same** in:
1. OAuth URL generation (`getXeroAuthUrl`)
2. Callback handling (`XeroRedirect.tsx`)
3. Xero app configuration

This ensures the OAuth flow works correctly!
